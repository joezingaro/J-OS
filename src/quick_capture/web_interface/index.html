<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Capture</title>
    <!-- Point to shared vendor script -->
    <script src="../../vendor/tailwind.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'neon-pink': '#ff00de',
                        'neon-blue': '#3333ff',
                        'neon-cyan': '#00ffcc',
                        'dark-bg': '#1e1e1e',
                        'panel-bg': '#252526',
                        'border-color': '#333333',
                    },
                    fontFamily: {
                        'mono': ['"Source Code Pro"', 'monospace'],
                    },
                    animation: {
                        'rgb-border': 'rgbBorder 12s linear infinite',
                        'rgb-text': 'rgbText 12s linear infinite',
                        'explode': 'explode 0.6s forwards cubic-bezier(0.16, 1, 0.3, 1)',
                    },
                    keyframes: {
                        rgbBorder: {
                            '0%, 100%': { borderColor: 'rgba(255, 0, 222, 0.9)', boxShadow: '0 0 10px rgba(255, 0, 222, 0.3)' },
                            '33%': { borderColor: 'rgba(0, 255, 204, 0.9)', boxShadow: '0 0 10px rgba(0, 255, 204, 0.3)' },
                            '66%': { borderColor: 'rgba(51, 51, 255, 0.9)', boxShadow: '0 0 10px rgba(51, 51, 255, 0.3)' },
                        },
                        rgbText: {
                            '0%, 100%': { color: 'rgba(255, 0, 222, 0.9)' },
                            '33%': { color: 'rgba(0, 255, 204, 0.9)' },
                            '66%': { color: 'rgba(51, 51, 255, 0.9)' },
                        },
                        explode: {
                            '0%': { opacity: '1', transform: 'translate(0,0) rotate(0) scale(1)' },
                            '100%': { opacity: '0', transform: 'translate(var(--tx), var(--ty)) rotate(var(--r)) scale(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background: transparent;
            overflow: hidden;
        }

        .drag-zone {
            -webkit-app-region: no-drag;
            cursor: grab;
        }

        .resize-handle {
            cursor: nwse-resize;
            background: linear-gradient(135deg, transparent 50%, rgba(255, 255, 255, 0.1) 50%);
        }

        textarea::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>

<body
    class="flex justify-center items-end h-screen w-screen pb-5 font-mono selection:bg-neon-pink selection:text-white">

    <!-- Main Container -->
    <div id="main-container"
        class="relative w-[95%] max-w-[950px] h-full flex flex-col bg-dark-bg rounded-lg border border-transparent shadow-2xl transition-all duration-300 animate-rgb-border opacity-100 scale-100 origin-center text-sm text-[#cccccc]">

        <!-- Header -->
        <div class="h-8 w-full flex items-center px-4 shrink-0 bg-transparent">
            <div class="drag-zone grow h-full" id="drag-zone"></div>
            <div class="flex items-center gap-3">
                <button id="max-btn"
                    class="w-6 h-6 flex items-center justify-center rounded text-gray-500 hover:text-white hover:bg-white/10 transition-colors">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    </svg>
                </button>
                <button id="close-btn"
                    class="w-6 h-6 flex items-center justify-center rounded text-gray-500 hover:text-red-500 hover:bg-red-500/10 transition-colors">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Body: Input + Log Button (FIXED LAYOUT: items-stretch) -->
        <div id="body-area" class="flex grow items-stretch px-4 pt-0 pb-3 w-full relative">
            <!-- Wrapper for particle effects -->
            <div id="input-wrapper" class="grow flex items-stretch relative">
                <textarea id="quick-input" rows="1"
                    class="w-full bg-transparent border-none outline-none resize-none h-6 leading-6 placeholder-gray-600 transition-all duration-200"
                    placeholder=">> Type something... (Shift+Enter for new line)" autocomplete="off"></textarea>
            </div>

            <!-- Log Button (Self-End for bottom alignment) -->
            <button id="log-button"
                class="self-end mb-0 ml-3 px-3 py-1 bg-panel-bg rounded border border-border-color text-white text-xs font-bold tracking-wide animate-rgb-text hover:brightness-110 active:scale-95 transition-all">
                LOG ITEM
            </button>
        </div>

    </div>
    </div>

    <!-- Success Toast -->
    <div id="success-toast"
        class="fixed inset-0 pointer-events-none flex items-center justify-center opacity-0 scale-75 transition-all duration-300 z-[100]">
        <div
            class="px-6 py-3 bg-dark-bg border border-neon-cyan rounded-full shadow-[0_0_20px_rgba(0,255,204,0.3)] text-neon-cyan font-bold tracking-wider text-lg animate-pulse">
            MESSAGE LOGGED
        </div>
    </div>

    <script>
        const container = document.getElementById('main-container');
        const bodyArea = document.getElementById('body-area');
        const inputWrapper = document.getElementById('input-wrapper');
        const input = document.getElementById('quick-input');
        const toast = document.getElementById('success-toast');
        const logBtn = document.getElementById('log-button');
        const dragZone = document.getElementById('drag-zone');
        // Drag Zone is now visual-only or handled by hit-test coordinates
        const maxBtn = document.getElementById('max-btn');
        const closeBtn = document.getElementById('close-btn');

        const prompts = ["Ready to capture.", "What's on your mind?", "Log it before you lose it."];

        function setPlaceholder() {
            input.placeholder = `>> ${prompts[Math.floor(Math.random() * prompts.length)]}`;
        }

        function saveData(text) {
            if (!text.trim()) return;
            document.title = "CMD:SAVE:" + text;
            // No Animation - Instant Close is handled by Py backend response (or title trigger)
            resetUI();
        }



        function resetUI() {
            input.value = "";
            setPlaceholder();

            // Reset Animation State (Cleanup just in case)
            input.classList.remove('opacity-0');
            logBtn.classList.remove('opacity-0');

            // Reset Maximize State
            window.expanded = false;
            container.classList.remove('expanded');
            input.classList.remove('h-full', 'items-start'); // Reset expanded class logic
            input.classList.add('h-6');
        }

        // --- Event Listeners ---
        input.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.title = "CMD:CLOSE:" + Date.now();
            } else if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                saveData(input.value);
            }
        });

        // Log Button
        logBtn.addEventListener('click', () => saveData(input.value));

        // Dragging - TRIGGER SYSTEM MOVE
        dragZone.addEventListener('mousedown', (e) => {
            if (e.button === 0) { // Left Click Only
                document.title = "CMD:START_DRAG:" + Date.now();
            }
        });

        // Maximize Logic (Fix Layout)
        window.expanded = false;
        maxBtn.addEventListener('click', () => {
            window.expanded = !window.expanded;
            if (window.expanded) {
                container.classList.add('expanded');
                // Make input stretch to fill
                input.classList.remove('h-6');
                input.classList.add('h-full');
            } else {
                container.classList.remove('expanded');
                input.classList.remove('h-full');
                input.classList.add('h-6');
            }
            document.title = (window.expanded ? "CMD:MAXIMIZE" : "CMD:MINIMIZE") + ":" + Date.now();
            input.focus();
        });

        // Close (Hide Window)
        // Close Logic: Two-Stage (Activate -> Confirm)
        let closeResetTimer = null;

        function resetCloseButtonState() {
            if (closeResetTimer) clearTimeout(closeResetTimer);
            closeBtn.classList.remove('text-red-500', 'bg-red-500/20');
            closeBtn.classList.add('text-gray-500', 'hover:text-red-500', 'hover:bg-red-500/10'); // Restore original classes
        }

        closeBtn.addEventListener('click', (e) => {
            const isArmed = closeBtn.classList.contains('text-red-500');

            if (isArmed) {
                // CONFIRMATION CLICK: Reset & Close
                document.title = "CMD:RESET_CLOSE:" + Date.now();
                resetCloseButtonState();
                setTimeout(resetUI, 50);
            } else {
                // ACTIVATION CLICK: Arm the button
                // Remove hover classes to keep it "stuck" in active state
                closeBtn.classList.remove('text-gray-500', 'hover:text-red-500', 'hover:bg-red-500/10');
                closeBtn.classList.add('text-red-500', 'bg-red-500/20');

                // Auto-reset state if not confirmed within 2 seconds
                if (closeResetTimer) clearTimeout(closeResetTimer);
                closeResetTimer = setTimeout(resetCloseButtonState, 2000);
            }
        });

        setPlaceholder();
        input.focus();
    </script>
</body>

</html>